<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.4">
  <compounddef id="_persistence_8m" kind="file">
    <compoundname>Persistence.m</compoundname>
    <includes refid="_persistence_8h" local="yes">Persistence.h</includes>
    <includes refid="_uml_pad_global_8h" local="yes">UmlPadGlobal.h</includes>
    <includes refid="_diagram_view_8h" local="yes">DiagramView.h</includes>
    <includes refid="_panel_manager_8h" local="yes">PanelManager.h</includes>
    <includes refid="_image_creator_8h" local="yes">ImageCreator.h</includes>
    <incdepgraph>
      <node id="1790">
        <label>DiagramInfo.h</label>
        <link refid="_diagram_info_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
      </node>
      <node id="1792">
        <label>ViewElement.h</label>
        <link refid="_view_element_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1787">
        <label>UIKit/UIKit.h</label>
      </node>
      <node id="1797">
        <label>ConnectorTargetCommandPanel.h</label>
        <link refid="_connector_target_command_panel_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
        <childnode refid="1796" relation="include">
        </childnode>
      </node>
      <node id="1796">
        <label>CommandPanel.h</label>
        <link refid="_command_panel_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1789">
        <label>DiagramFrameView.h</label>
        <link refid="_diagram_frame_view_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1783">
        <label>Persistence.h</label>
        <link refid="_persistence_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
      </node>
      <node id="1782">
        <label>Classes/Persistence.m</label>
        <link refid="Persistence.m"/>
        <childnode refid="1783" relation="include">
        </childnode>
        <childnode refid="1785" relation="include">
        </childnode>
        <childnode refid="1793" relation="include">
        </childnode>
        <childnode refid="1794" relation="include">
        </childnode>
        <childnode refid="1799" relation="include">
        </childnode>
      </node>
      <node id="1788">
        <label>DiagramFrameViewController.h</label>
        <link refid="_diagram_frame_view_controller_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1791">
        <label>CommandManager.h</label>
        <link refid="_command_manager_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
      </node>
      <node id="1799">
        <label>ImageCreator.h</label>
        <link refid="_image_creator_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
      </node>
      <node id="1795">
        <label>BasicCommandPanel.h</label>
        <link refid="_basic_command_panel_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
        <childnode refid="1796" relation="include">
        </childnode>
      </node>
      <node id="1786">
        <label>HomeViewController.h</label>
        <link refid="_home_view_controller_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1784">
        <label>Foundation/Foundation.h</label>
      </node>
      <node id="1785">
        <label>UmlPadGlobal.h</label>
        <link refid="_uml_pad_global_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
        <childnode refid="1786" relation="include">
        </childnode>
        <childnode refid="1788" relation="include">
        </childnode>
        <childnode refid="1789" relation="include">
        </childnode>
        <childnode refid="1790" relation="include">
        </childnode>
        <childnode refid="1791" relation="include">
        </childnode>
        <childnode refid="1792" relation="include">
        </childnode>
      </node>
      <node id="1794">
        <label>PanelManager.h</label>
        <link refid="_panel_manager_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
        <childnode refid="1795" relation="include">
        </childnode>
        <childnode refid="1797" relation="include">
        </childnode>
        <childnode refid="1798" relation="include">
        </childnode>
      </node>
      <node id="1793">
        <label>DiagramView.h</label>
        <link refid="_diagram_view_8h"/>
        <childnode refid="1787" relation="include">
        </childnode>
      </node>
      <node id="1798">
        <label>SelectConnectorTypePanel.h</label>
        <link refid="_select_connector_type_panel_8h"/>
        <childnode refid="1784" relation="include">
        </childnode>
        <childnode refid="1796" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Persistence.m</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>UmlPad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Created<sp/>by<sp/>梅田<sp/>政利<sp/>on<sp/>10/07/09.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Copyright<sp/>2010<sp/>Change<sp/>Vision.<sp/>All<sp/>rights<sp/>reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#import<sp/>&quot;<ref refid="_persistence_8h" kindref="compound">Persistence.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#import<sp/>&quot;<ref refid="_uml_pad_global_8h" kindref="compound">UmlPadGlobal.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#import<sp/>&quot;<ref refid="_diagram_view_8h" kindref="compound">DiagramView.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#import<sp/>&quot;<ref refid="_panel_manager_8h" kindref="compound">PanelManager.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#import<sp/>&quot;<ref refid="_image_creator_8h" kindref="compound">ImageCreator.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">@implementation<sp/></highlight><highlight class="normal"><ref refid="interface_persistence" kindref="compound">Persistence</ref></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal">+<sp/>(NSString<sp/>*)getDocumentsDir<sp/>{</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>NSArray<sp/>*paths<sp/>=<sp/>NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,<sp/>NSUserDomainMask,<sp/>YES);</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[paths<sp/>objectAtIndex:0];</highlight></codeline>
<codeline lineno="21"><highlight class="normal">}</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal">+<sp/>(NSString<sp/>*)getDiagramInfoFullPath<sp/>{</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDocumentsDir]<sp/>stringByAppendingPathComponent:@&quot;diagrams.dat&quot;];</highlight></codeline>
<codeline lineno="25"><highlight class="normal">}</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal">+<sp/>(NSString<sp/>*)getDiagramFullPath:(NSUInteger)diagramId<sp/>{</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*filePath<sp/>=<sp/>[NSString<sp/>stringWithFormat:@&quot;diagram%d.dat&quot;,<sp/>diagramId];</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDocumentsDir]<sp/>stringByAppendingPathComponent:filePath];</highlight></codeline>
<codeline lineno="30"><highlight class="normal">}</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal">+<sp/>(NSString<sp/>*)getDiagramThumbFullPath:(NSUInteger)diagramId<sp/>{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*filePath<sp/>=<sp/>[NSString<sp/>stringWithFormat:@&quot;diagram%d_thumb.png&quot;,<sp/>diagramId];</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDocumentsDir]<sp/>stringByAppendingPathComponent:filePath];</highlight></codeline>
<codeline lineno="35"><highlight class="normal">}</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal">+<sp/>(void)<ref refid="interface_persistence_1a2d26cf5dcac75e747135ea790d180f91" kindref="member">storeData</ref><sp/>{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/>*global<sp/>=<sp/>[<ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/><ref refid="interface_uml_pad_global_1a1c23e6d815bd1f9f6b37bb8c94a84532" kindref="member">instance</ref>];</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>[NSKeyedArchiver<sp/>archiveRootObject:global.diagramInfos<sp/>toFile:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramInfoFullPath]];</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>*dInfo<sp/>in<sp/>global.<ref refid="interface_uml_pad_global_1a36d58fc0bc4d410abb5ab49e0e9d91f2" kindref="member">diagramInfos</ref>)<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dInfo.showDiagram)<sp/>{</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>storeDiagram:dInfo];</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="46"><highlight class="normal">}</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal">+<sp/>(NSUInteger)<ref refid="interface_persistence_1a5dfd98484c9f77b52542ce747fee5d4a" kindref="member">getUnusedDiagramId</ref><sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/>*global<sp/>=<sp/>[<ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/><ref refid="interface_uml_pad_global_1a1c23e6d815bd1f9f6b37bb8c94a84532" kindref="member">instance</ref>];</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(global.<ref refid="interface_uml_pad_global_1a36d58fc0bc4d410abb5ab49e0e9d91f2" kindref="member">diagramInfos</ref><sp/>==<sp/>nil)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>count<sp/>=<sp/>[global.diagramInfos<sp/>count];</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>BOOL<sp/>*ids<sp/>=<sp/>(BOOL<sp/>*)calloc(count,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(BOOL));</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>*dInfo<sp/>in<sp/>global.<ref refid="interface_uml_pad_global_1a36d58fc0bc4d410abb5ab49e0e9d91f2" kindref="member">diagramInfos</ref>)<sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dInfo.diagramId<sp/>&lt;<sp/>count)<sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ids[dInfo.diagramId]<sp/>=<sp/>YES;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>emptyId<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(emptyId<sp/>&lt;<sp/>count<sp/>&amp;&amp;<sp/>ids[emptyId])<sp/>emptyId++;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>free(ids);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>emptyId;</highlight></codeline>
<codeline lineno="64"><highlight class="normal">}</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal">+<sp/>(void)<ref refid="interface_persistence_1a6e10568864adb0f6e197ec0c7c2b4e13" kindref="member">restoreData</ref><sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>NSMutableArray<sp/>*array<sp/>=<sp/>[NSKeyedUnarchiver<sp/>unarchiveObjectWithFile:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramInfoFullPath]];</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array<sp/>==<sp/>nil)<sp/>{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array<sp/>=<sp/>[[[NSMutableArray<sp/>alloc]<sp/>init]<sp/>autorelease];</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>*dInfo<sp/>=<sp/>[[[<ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>alloc]<sp/>init]<sp/>autorelease];</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dInfo.<ref refid="interface_diagram_info_1affa7e1c59cf91ae81aeee47a726c04fb" kindref="member">name</ref><sp/>=<sp/>[NSString<sp/>stringWithFormat:@&quot;diagram&quot;];</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dInfo.<ref refid="interface_diagram_info_1ae953f6b97bc81d4f533a1fc7e35c5dd1" kindref="member">diagramId</ref><sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getUnusedDiagramId];</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[array<sp/>addObject:dInfo];</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/>*global<sp/>=<sp/>[<ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/><ref refid="interface_uml_pad_global_1a1c23e6d815bd1f9f6b37bb8c94a84532" kindref="member">instance</ref>];</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>global.<ref refid="interface_uml_pad_global_1a36d58fc0bc4d410abb5ab49e0e9d91f2" kindref="member">diagramInfos</ref><sp/>=<sp/>array;</highlight></codeline>
<codeline lineno="77"><highlight class="normal">}<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal">+<sp/>(void)storeDiagram:(<ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>*)dInfo<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/>*global<sp/>=<sp/>[<ref refid="interface_uml_pad_global" kindref="compound">UmlPadGlobal</ref><sp/><ref refid="interface_uml_pad_global_1a1c23e6d815bd1f9f6b37bb8c94a84532" kindref="member">instance</ref>];</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>w<sp/>=<sp/>global.<ref refid="interface_uml_pad_global_1a8c9e606239b5ec9d02e5690656e205ac" kindref="member">diagramFrameView</ref>.frame.size.width;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>h<sp/>=<sp/>global.<ref refid="interface_uml_pad_global_1a8c9e606239b5ec9d02e5690656e205ac" kindref="member">diagramFrameView</ref>.frame.size.height;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>offsetX<sp/>=<sp/>global.<ref refid="interface_uml_pad_global_1a8c9e606239b5ec9d02e5690656e205ac" kindref="member">diagramFrameView</ref>.contentOffset.x;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>offsetY<sp/>=<sp/>global.<ref refid="interface_uml_pad_global_1a8c9e606239b5ec9d02e5690656e205ac" kindref="member">diagramFrameView</ref>.contentOffset.y;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>dInfo.<ref refid="interface_diagram_info_1a30f0b24ca3c76c1e1af8b56c82e0edb5" kindref="member">diagramView</ref>.<ref refid="interface_diagram_view_1af5cb3264fa4c1dd79a92a9a86b604cc2" kindref="member">viewPoint</ref><sp/>=<sp/>CGPointMake(offsetX<sp/>+<sp/>w<sp/>/<sp/>2,<sp/>offsetY<sp/>+<sp/>h<sp/>/<sp/>2);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>dInfo.<ref refid="interface_diagram_info_1a30f0b24ca3c76c1e1af8b56c82e0edb5" kindref="member">diagramView</ref>.<ref refid="interface_diagram_view_1a8877667c3f5ee8516ae780e8644f0db3" kindref="member">viewScale</ref><sp/>=<sp/>global.<ref refid="interface_uml_pad_global_1a8c9e606239b5ec9d02e5690656e205ac" kindref="member">diagramFrameView</ref>.zoomScale;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>[NSKeyedArchiver<sp/>archiveRootObject:dInfo.diagramView<sp/>toFile:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramFullPath:dInfo.diagramId]];</highlight></codeline>
<codeline lineno="88"><highlight class="normal">}</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal">+<sp/>(void)restoreDiagram:(<ref refid="interface_diagram_info" kindref="compound">DiagramInfo</ref><sp/>*)dInfo<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interface_diagram_view" kindref="compound">DiagramView</ref><sp/>*diagramView<sp/>=<sp/>[NSKeyedUnarchiver<sp/>unarchiveObjectWithFile:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramFullPath:dInfo.diagramId]];</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!diagramView)<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diagramView<sp/>=<sp/>[[[<ref refid="interface_diagram_view" kindref="compound">DiagramView</ref><sp/>alloc]<sp/>initWithFrame:CGRectMake(0,<sp/>0,<sp/>VIEW_WIDTH,<sp/>VIEW_HEIGHT)]<sp/>autorelease];</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diagramView.userInteractionEnabled<sp/>=<sp/>NO;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diagramView.<ref refid="interface_diagram_view_1af5cb3264fa4c1dd79a92a9a86b604cc2" kindref="member">viewPoint</ref><sp/>=<sp/>diagramView.center;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diagramView.<ref refid="interface_diagram_view_1a8877667c3f5ee8516ae780e8644f0db3" kindref="member">viewScale</ref><sp/>=<sp/>1.0;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>dInfo.<ref refid="interface_diagram_info_1a30f0b24ca3c76c1e1af8b56c82e0edb5" kindref="member">diagramView</ref><sp/>=<sp/>diagramView;</highlight></codeline>
<codeline lineno="99"><highlight class="normal">}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal">+<sp/>(void)storeThumbnail:(UIImage<sp/>*)image<sp/>id:(NSUInteger)diagramId<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>[<ref refid="interface_image_creator" kindref="compound">ImageCreator</ref><sp/><ref refid="interface_image_creator_1a4075a6445c25a723e122fa84742fece9" kindref="member">savePngFile</ref>:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramThumbFullPath:diagramId]<sp/><ref refid="interface_image_creator_1a4075a6445c25a723e122fa84742fece9" kindref="member">image</ref>:image];</highlight></codeline>
<codeline lineno="103"><highlight class="normal">}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal">+<sp/>(UIImage<sp/>*)restoreThumbnail:(NSUInteger)diagramId<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[UIImage<sp/>imageWithContentsOfFile:[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramThumbFullPath:diagramId]];</highlight></codeline>
<codeline lineno="107"><highlight class="normal">}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal">+<sp/>(void)removeRelatedFiles:(NSUInteger)diagramId<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>NSError*<sp/>error;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*diagramPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramFullPath:diagramId];</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>([[NSFileManager<sp/>defaultManager]<sp/>fileExistsAtPath:diagramPath])<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[[NSFileManager<sp/>defaultManager]<sp/>removeItemAtPath:diagramPath<sp/>error:&amp;error];</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*thumbnailPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramThumbFullPath:diagramId];</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>([[NSFileManager<sp/>defaultManager]<sp/>fileExistsAtPath:thumbnailPath])<sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[[NSFileManager<sp/>defaultManager]<sp/>removeItemAtPath:thumbnailPath<sp/>error:&amp;error];</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal">}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal">+<sp/>(void)copyRelatedFiles:(NSUInteger)srcDiagramId<sp/>to:(NSUInteger)dstDiagramId<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>NSError*<sp/>error;</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*srcDiagramPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramFullPath:srcDiagramId];</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*dstDiagramPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramFullPath:dstDiagramId];</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>([[NSFileManager<sp/>defaultManager]<sp/>fileExistsAtPath:srcDiagramPath])<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[[NSFileManager<sp/>defaultManager]<sp/>copyItemAtPath:srcDiagramPath<sp/>toPath:dstDiagramPath<sp/>error:&amp;error];</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*srcThumbnailPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramThumbFullPath:srcDiagramId];</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>NSString<sp/>*dstThumbnailPath<sp/>=<sp/>[</highlight><highlight class="keyword">self</highlight><highlight class="normal"><sp/>getDiagramThumbFullPath:dstDiagramId];</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>([[NSFileManager<sp/>defaultManager]<sp/>fileExistsAtPath:srcThumbnailPath])<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[[NSFileManager<sp/>defaultManager]<sp/>copyItemAtPath:srcThumbnailPath<sp/>toPath:dstThumbnailPath<sp/>error:&amp;error];</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="133"><highlight class="normal">}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight><highlight class="keyword">@end</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/Users/makoto/Documents/workspace/UmlPad/Classes/Persistence.m"/>
  </compounddef>
</doxygen>
